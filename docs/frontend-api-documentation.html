<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Top Tutors - Frontend API Documentation</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
      background: #fff;
    }
    h1 { color: #1a365d; border-bottom: 3px solid #3182ce; padding-bottom: 10px; margin-bottom: 30px; }
    h2 { color: #2c5282; margin-top: 40px; margin-bottom: 15px; border-left: 4px solid #3182ce; padding-left: 15px; }
    h3 { color: #2d3748; margin-top: 25px; margin-bottom: 10px; }
    h4 { color: #4a5568; margin-top: 15px; margin-bottom: 8px; }
    p { margin-bottom: 12px; }
    code { background: #edf2f7; padding: 2px 6px; border-radius: 4px; font-family: 'Consolas', monospace; font-size: 14px; }
    pre { background: #1a202c; color: #e2e8f0; padding: 15px; border-radius: 8px; overflow-x: auto; margin: 15px 0; font-size: 13px; }
    pre code { background: none; padding: 0; color: inherit; }
    table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 14px; }
    th, td { border: 1px solid #e2e8f0; padding: 10px 12px; text-align: left; }
    th { background: #3182ce; color: white; }
    tr:nth-child(even) { background: #f7fafc; }
    .badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
    .badge-get { background: #48bb78; color: white; }
    .badge-post { background: #4299e1; color: white; }
    .badge-patch { background: #ed8936; color: white; }
    .badge-delete { background: #f56565; color: white; }
    .badge-auth { background: #805ad5; color: white; }
    .badge-public { background: #38a169; color: white; }
    .warning { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px 15px; margin: 15px 0; border-radius: 0 8px 8px 0; }
    .info { background: #e0f2fe; border-left: 4px solid #0ea5e9; padding: 12px 15px; margin: 15px 0; border-radius: 0 8px 8px 0; }
    .success { background: #d1fae5; border-left: 4px solid #10b981; padding: 12px 15px; margin: 15px 0; border-radius: 0 8px 8px 0; }
    .error { background: #fee2e2; border-left: 4px solid #ef4444; padding: 12px 15px; margin: 15px 0; border-radius: 0 8px 8px 0; }
    .flow-step { background: #f7fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin: 10px 0; }
    .flow-step-number { display: inline-block; width: 28px; height: 28px; background: #3182ce; color: white; border-radius: 50%; text-align: center; line-height: 28px; font-weight: bold; margin-right: 10px; }
    .page-break { page-break-before: always; }
    @media print {
      body { padding: 20px; }
      pre { font-size: 11px; }
      .page-break { page-break-before: always; }
    }
  </style>
</head>
<body>

<h1>üéì Top Tutors - Frontend API Documentation</h1>
<p><strong>Version:</strong> 1.0.0 | <strong>Last Updated:</strong> December 7, 2025</p>
<p><strong>Backend Stack:</strong> NestJS + Fastify + PostgreSQL + Prisma + WebSocket</p>

<div class="info">
  <strong>üìå Quick Reference</strong><br>
  Base URL: <code>http://localhost:3000/api/v1</code><br>
  WebSocket: <code>http://localhost:3000/messages</code><br>
  Swagger Docs: <code>http://localhost:3000/docs</code>
</div>

<!-- TABLE OF CONTENTS -->
<h2>üìë Table of Contents</h2>
<ol>
  <li><a href="#setup">Project Setup & Configuration</a></li>
  <li><a href="#auth-flow">Authentication Flow</a></li>
  <li><a href="#auth-endpoints">Auth API Endpoints</a></li>
  <li><a href="#user-flow">User Management Flow</a></li>
  <li><a href="#user-endpoints">User API Endpoints</a></li>
  <li><a href="#messaging-flow">Messaging & Conversation Flow</a></li>
  <li><a href="#messaging-endpoints">Messaging API Endpoints</a></li>
  <li><a href="#websocket">WebSocket Real-time Events</a></li>
  <li><a href="#enums">Data Types & Enums</a></li>
  <li><a href="#error-handling">Error Handling</a></li>
  <li><a href="#test-accounts">Test Accounts</a></li>
  <li><a href="#frontend-checklist">Frontend Implementation Checklist</a></li>
</ol>

<!-- SECTION 1: SETUP -->
<h2 id="setup">1. Project Setup & Configuration</h2>

<h3>1.1 Environment Configuration</h3>
<pre><code>// .env.local (Frontend)
REACT_APP_API_BASE_URL=http://localhost:3000/api/v1
REACT_APP_WS_URL=http://localhost:3000
REACT_APP_GOOGLE_CLIENT_ID=your_google_client_id</code></pre>

<h3>1.2 Required Dependencies (React)</h3>
<pre><code>npm install axios socket.io-client react-router-dom
npm install @types/socket.io-client  // if using TypeScript</code></pre>

<h3>1.3 Axios Instance Setup</h3>
<pre><code>// src/api/axios.ts
import axios from 'axios';

const api = axios.create({
  baseURL: process.env.REACT_APP_API_BASE_URL,
  headers: { 'Content-Type': 'application/json' }
});

// Request interceptor - Add auth token
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('accessToken');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Response interceptor - Handle 401 errors
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      // Try to refresh token
      const refreshToken = localStorage.getItem('refreshToken');
      if (refreshToken) {
        try {
          const res = await axios.post(
            `${process.env.REACT_APP_API_BASE_URL}/auth/refresh`,
            { refreshToken }
          );
          localStorage.setItem('accessToken', res.data.tokens.accessToken);
          localStorage.setItem('refreshToken', res.data.tokens.refreshToken);
          // Retry original request
          error.config.headers.Authorization = `Bearer ${res.data.tokens.accessToken}`;
          return api.request(error.config);
        } catch (refreshError) {
          // Refresh failed - redirect to login
          localStorage.clear();
          window.location.href = '/login';
        }
      } else {
        // No refresh token - redirect to login
        localStorage.clear();
        window.location.href = '/login';
      }
    }
    return Promise.reject(error);
  }
);

export default api;</code></pre>

<div class="page-break"></div>

<!-- SECTION 2: AUTH FLOW -->
<h2 id="auth-flow">2. Authentication Flow</h2>

<h3>2.1 Login Flow</h3>
<div class="flow-step">
  <span class="flow-step-number">1</span>
  <strong>User visits /login page</strong>
  <p>Display login form with email and password fields</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">2</span>
  <strong>User submits credentials</strong>
  <p>Call <code>POST /auth/login</code></p>
</div>
<div class="flow-step">
  <span class="flow-step-number">3</span>
  <strong>On Success</strong>
  <p>Store tokens in localStorage, redirect based on role:</p>
  <ul>
    <li><code>STUDENT</code> ‚Üí <code>/dashboard/student</code></li>
    <li><code>TUTOR</code> ‚Üí <code>/dashboard/tutor</code></li>
    <li><code>ADMIN</code> ‚Üí <code>/admin</code></li>
  </ul>
</div>
<div class="flow-step">
  <span class="flow-step-number">4</span>
  <strong>On Error</strong>
  <p>Display error message: "Invalid email or password"</p>
</div>

<h3>2.2 Registration Flow (Students Only)</h3>
<div class="flow-step">
  <span class="flow-step-number">1</span>
  <strong>User visits /register page</strong>
  <p>Display registration form: name, email, password, confirm password</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">2</span>
  <strong>Frontend Validation</strong>
  <ul>
    <li>Email format validation</li>
    <li>Password minimum 8 chars, 1 uppercase, 1 number</li>
    <li>Passwords match</li>
  </ul>
</div>
<div class="flow-step">
  <span class="flow-step-number">3</span>
  <strong>Submit</strong>
  <p>Call <code>POST /auth/register/student</code></p>
</div>
<div class="flow-step">
  <span class="flow-step-number">4</span>
  <strong>On Success</strong>
  <p>Auto-login user (tokens returned), redirect to student dashboard</p>
</div>

<h3>2.3 Google OAuth Flow</h3>
<div class="flow-step">
  <span class="flow-step-number">1</span>
  <strong>User clicks "Sign in with Google"</strong>
  <p>Redirect to: <code>http://localhost:3000/api/v1/auth/google</code></p>
</div>
<div class="flow-step">
  <span class="flow-step-number">2</span>
  <strong>Google Authentication</strong>
  <p>User authenticates with Google</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">3</span>
  <strong>Callback</strong>
  <p>Backend redirects to: <code>http://localhost:3001/auth/callback?accessToken=xxx&refreshToken=xxx</code></p>
</div>
<div class="flow-step">
  <span class="flow-step-number">4</span>
  <strong>Frontend handles callback</strong>
  <p>Extract tokens from URL params, store in localStorage, redirect to dashboard</p>
</div>

<h3>2.4 Protected Route Logic</h3>
<pre><code>// src/components/ProtectedRoute.tsx
const ProtectedRoute = ({ children, allowedRoles }) => {
  const token = localStorage.getItem('accessToken');
  const user = useAuth(); // Your auth context
  
  if (!token) {
    // Not logged in - redirect to login
    return &lt;Navigate to="/login" state={{ from: location }} /&gt;;
  }
  
  if (allowedRoles && !allowedRoles.includes(user?.role)) {
    // Not authorized - redirect to appropriate dashboard
    return &lt;Navigate to="/unauthorized" /&gt;;
  }
  
  return children;
};</code></pre>

<div class="page-break"></div>

<!-- SECTION 3: AUTH ENDPOINTS -->
<h2 id="auth-endpoints">3. Auth API Endpoints</h2>

<table>
  <tr>
    <th>Method</th>
    <th>Endpoint</th>
    <th>Auth</th>
    <th>Description</th>
  </tr>
  <tr>
    <td><span class="badge badge-post">POST</span></td>
    <td><code>/auth/register/student</code></td>
    <td><span class="badge badge-public">Public</span></td>
    <td>Register new student</td>
  </tr>
  <tr>
    <td><span class="badge badge-post">POST</span></td>
    <td><code>/auth/login</code></td>
    <td><span class="badge badge-public">Public</span></td>
    <td>Login with email/password</td>
  </tr>
  <tr>
    <td><span class="badge badge-get">GET</span></td>
    <td><code>/auth/google</code></td>
    <td><span class="badge badge-public">Public</span></td>
    <td>Initiate Google OAuth</td>
  </tr>
  <tr>
    <td><span class="badge badge-post">POST</span></td>
    <td><code>/auth/refresh</code></td>
    <td><span class="badge badge-public">Public</span></td>
    <td>Refresh access token</td>
  </tr>
  <tr>
    <td><span class="badge badge-post">POST</span></td>
    <td><code>/auth/logout</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Logout user</td>
  </tr>
  <tr>
    <td><span class="badge badge-get">GET</span></td>
    <td><code>/auth/profile</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Get current user profile</td>
  </tr>
</table>

<h3>3.1 POST /auth/register/student</h3>
<h4>Request Body:</h4>
<pre><code>{
  "email": "student@example.com",    // string, required, valid email
  "password": "Password123!",        // string, required, min 8 chars
  "name": "John Doe"                 // string, required
}</code></pre>

<h4>Success Response (201):</h4>
<pre><code>{
  "success": true,
  "statusCode": 201,
  "message": "Success",
  "data": {
    "user": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "email": "student@example.com",
      "name": "John Doe",
      "role": "STUDENT",
      "isActive": true
    },
    "tokens": {
      "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    }
  },
  "timestamp": "2025-12-07T12:00:00.000Z"
}</code></pre>

<h4>Error Response (409 - User Exists):</h4>
<pre><code>{
  "statusCode": 409,
  "message": "User with this email already exists",
  "error": "Conflict"
}</code></pre>

<h3>3.2 POST /auth/login</h3>
<h4>Request Body:</h4>
<pre><code>{
  "email": "student@example.com",    // string, required
  "password": "Password123!"         // string, required
}</code></pre>

<h4>Success Response (200):</h4>
<pre><code>{
  "success": true,
  "statusCode": 200,
  "message": "Success",
  "data": {
    "user": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "email": "student@example.com",
      "name": "John Doe",
      "role": "STUDENT",
      "isActive": true
    },
    "tokens": {
      "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    }
  },
  "timestamp": "2025-12-07T12:00:00.000Z"
}</code></pre>

<h4>Error Response (401):</h4>
<pre><code>{
  "statusCode": 401,
  "message": "Invalid credentials",
  "error": "Unauthorized"
}</code></pre>

<h3>3.3 POST /auth/refresh</h3>
<h4>Request Body:</h4>
<pre><code>{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}</code></pre>

<h4>Success Response (200):</h4>
<pre><code>{
  "success": true,
  "data": {
    "tokens": {
      "accessToken": "new_access_token...",
      "refreshToken": "new_refresh_token..."
    }
  }
}</code></pre>

<h3>3.4 GET /auth/profile</h3>
<h4>Headers:</h4>
<pre><code>Authorization: Bearer &lt;access_token&gt;</code></pre>

<h4>Success Response (200):</h4>
<pre><code>{
  "success": true,
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "student@example.com",
    "name": "John Doe",
    "role": "STUDENT",
    "isActive": true,
    "createdAt": "2025-12-07T12:00:00.000Z"
  }
}</code></pre>

<div class="page-break"></div>

<!-- SECTION 4: USER FLOW -->
<h2 id="user-flow">4. User Management Flow</h2>

<h3>4.1 View All Users (Admin Only)</h3>
<div class="flow-step">
  <span class="flow-step-number">1</span>
  <strong>Admin navigates to /admin/users</strong>
  <p>Check if user role is ADMIN, otherwise redirect to unauthorized</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">2</span>
  <strong>Fetch users with pagination</strong>
  <p>Call <code>GET /users?page=1&limit=10</code></p>
</div>
<div class="flow-step">
  <span class="flow-step-number">3</span>
  <strong>Display users table</strong>
  <p>Show: Name, Email, Role, Status, Created Date, Actions</p>
</div>

<h3>4.2 Search/Filter Users</h3>
<div class="warning">
  <strong>‚ö†Ô∏è Note:</strong> Search is done client-side on current page data, or implement debounced API calls if backend search is added later.
</div>

<div class="page-break"></div>

<!-- SECTION 5: USER ENDPOINTS -->
<h2 id="user-endpoints">5. User API Endpoints</h2>

<table>
  <tr>
    <th>Method</th>
    <th>Endpoint</th>
    <th>Auth</th>
    <th>Description</th>
  </tr>
  <tr>
    <td><span class="badge badge-get">GET</span></td>
    <td><code>/users</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Get all users (paginated)</td>
  </tr>
  <tr>
    <td><span class="badge badge-get">GET</span></td>
    <td><code>/users/:id</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Get user by ID</td>
  </tr>
  <tr>
    <td><span class="badge badge-post">POST</span></td>
    <td><code>/users</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Create user</td>
  </tr>
  <tr>
    <td><span class="badge badge-patch">PATCH</span></td>
    <td><code>/users/:id</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Update user</td>
  </tr>
  <tr>
    <td><span class="badge badge-delete">DELETE</span></td>
    <td><code>/users/:id</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Delete user</td>
  </tr>
</table>

<h3>5.1 GET /users</h3>
<h4>Query Parameters:</h4>
<pre><code>page: number (default: 1)
limit: number (default: 10)</code></pre>

<h4>Success Response (200):</h4>
<pre><code>{
  "success": true,
  "data": {
    "data": [
      {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "email": "student@example.com",
        "name": "John Doe",
        "role": "STUDENT",
        "isActive": true,
        "createdAt": "2025-12-07T12:00:00.000Z",
        "updatedAt": "2025-12-07T12:00:00.000Z"
      }
    ],
    "meta": {
      "total": 50,
      "page": 1,
      "limit": 10,
      "totalPages": 5
    }
  }
}</code></pre>

<div class="page-break"></div>

<!-- SECTION 6: MESSAGING FLOW -->
<h2 id="messaging-flow">6. Messaging & Conversation Flow</h2>

<h3>6.1 Student Sends Question (Main Flow)</h3>
<div class="flow-step">
  <span class="flow-step-number">1</span>
  <strong>Student clicks "Ask a Question" button</strong>
  <p>Navigate to /ask or open modal</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">2</span>
  <strong>Student types/records message</strong>
  <p>Text input or audio recording (future)</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">3</span>
  <strong>Submit message</strong>
  <p>Call <code>POST /messages/send</code> with content</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">4</span>
  <strong>Backend Processing (Automatic)</strong>
  <ul>
    <li>AI classifies message ‚Üí subject, topic, urgency</li>
    <li>System finds best matching tutor</li>
    <li>Creates conversation with auto-assigned tutor</li>
  </ul>
</div>
<div class="flow-step">
  <span class="flow-step-number">5</span>
  <strong>Show confirmation</strong>
  <p>Display: "Your question has been sent to [Tutor Name]!"</p>
  <p>Redirect to conversation view</p>
</div>

<h3>6.2 Tutor Receives Assignment (Real-time)</h3>
<div class="flow-step">
  <span class="flow-step-number">1</span>
  <strong>Tutor is logged in with WebSocket connected</strong>
  <p>Listen for 'newAssignment' event</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">2</span>
  <strong>Notification received</strong>
  <p>Show toast/notification: "New question from [Student] about [Subject]"</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">3</span>
  <strong>Tutor clicks notification</strong>
  <p>Navigate to conversation: /conversations/:id</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">4</span>
  <strong>Tutor replies</strong>
  <p>Call <code>POST /messages/send</code> with conversationId</p>
</div>

<h3>6.3 View Conversations List</h3>
<div class="flow-step">
  <span class="flow-step-number">1</span>
  <strong>User navigates to /conversations</strong>
</div>
<div class="flow-step">
  <span class="flow-step-number">2</span>
  <strong>Fetch conversations</strong>
  <p>Call <code>GET /messages/conversations</code></p>
  <p>Backend returns different data based on role (student sees their convos, tutor sees assigned)</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">3</span>
  <strong>Display conversation list</strong>
  <p>Show: Subject badge, Topic, Last message preview, Time, Urgency indicator, Status</p>
</div>

<h3>6.4 Conversation Chat View</h3>
<div class="flow-step">
  <span class="flow-step-number">1</span>
  <strong>User clicks on conversation</strong>
  <p>Navigate to /conversations/:id</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">2</span>
  <strong>Fetch conversation details</strong>
  <p>Call <code>GET /messages/conversations/:id</code></p>
</div>
<div class="flow-step">
  <span class="flow-step-number">3</span>
  <strong>Join WebSocket room</strong>
  <p>Emit: <code>socket.emit('joinConversation', conversationId)</code></p>
</div>
<div class="flow-step">
  <span class="flow-step-number">4</span>
  <strong>Display messages</strong>
  <p>Show chat bubbles (align left for other, right for self)</p>
</div>
<div class="flow-step">
  <span class="flow-step-number">5</span>
  <strong>Mark as read</strong>
  <p>Call <code>POST /messages/conversations/:id/read</code></p>
</div>
<div class="flow-step">
  <span class="flow-step-number">6</span>
  <strong>Listen for new messages</strong>
  <p>WebSocket: <code>socket.on('newMessage', ...)</code></p>
</div>

<div class="page-break"></div>

<!-- SECTION 7: MESSAGING ENDPOINTS -->
<h2 id="messaging-endpoints">7. Messaging API Endpoints</h2>

<table>
  <tr>
    <th>Method</th>
    <th>Endpoint</th>
    <th>Auth</th>
    <th>Description</th>
  </tr>
  <tr>
    <td><span class="badge badge-post">POST</span></td>
    <td><code>/messages/send</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Send message (creates conversation if new)</td>
  </tr>
  <tr>
    <td><span class="badge badge-get">GET</span></td>
    <td><code>/messages/conversations</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Get my conversations</td>
  </tr>
  <tr>
    <td><span class="badge badge-get">GET</span></td>
    <td><code>/messages/conversations/pending</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Get unassigned conversations (Admin)</td>
  </tr>
  <tr>
    <td><span class="badge badge-get">GET</span></td>
    <td><code>/messages/conversations/:id</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Get conversation with all messages</td>
  </tr>
  <tr>
    <td><span class="badge badge-post">POST</span></td>
    <td><code>/messages/conversations/:id/assign</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Assign tutor to conversation</td>
  </tr>
  <tr>
    <td><span class="badge badge-post">POST</span></td>
    <td><code>/messages/conversations/:id/close</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Close/resolve conversation</td>
  </tr>
  <tr>
    <td><span class="badge badge-post">POST</span></td>
    <td><code>/messages/conversations/:id/read</code></td>
    <td><span class="badge badge-auth">Auth</span></td>
    <td>Mark messages as read</td>
  </tr>
</table>

<h3>7.1 POST /messages/send</h3>
<h4>Request Body (New Conversation):</h4>
<pre><code>{
  "content": "I need help with quadratic equations",  // string, required for TEXT
  "messageType": "TEXT"  // "TEXT" | "AUDIO" | "IMAGE" | "FILE"
}</code></pre>

<h4>Request Body (Reply to Existing):</h4>
<pre><code>{
  "content": "Can you explain the formula?",
  "messageType": "TEXT",
  "conversationId": "550e8400-e29b-41d4-a716-446655440000"  // UUID
}</code></pre>

<h4>Success Response (201):</h4>
<pre><code>{
  "success": true,
  "data": {
    "message": {
      "id": "msg-uuid",
      "conversationId": "conv-uuid",
      "senderId": "user-uuid",
      "senderType": "STUDENT",
      "content": "I need help with quadratic equations",
      "messageType": "TEXT",
      "isRead": false,
      "createdAt": "2025-12-07T12:00:00.000Z"
    },
    "conversation": {
      "id": "conv-uuid",
      "studentId": "student-profile-uuid",
      "tutorId": "tutor-profile-uuid",
      "subject": "MATHEMATICS",
      "topic": "Quadratic Equations",
      "keywords": ["quadratic", "equations", "algebra"],
      "urgency": "NORMAL",
      "status": "ASSIGNED",
      "student": {
        "id": "...",
        "user": { "name": "Jane Smith", "email": "jane@..." }
      },
      "tutor": {
        "id": "...",
        "user": { "name": "John Williams", "email": "john@..." }
      },
      "messages": [...]
    }
  }
}</code></pre>

<h3>7.2 GET /messages/conversations</h3>
<h4>Query Parameters:</h4>
<pre><code>page: number (default: 1)
limit: number (default: 10)
status: "PENDING" | "ASSIGNED" | "ACTIVE" | "RESOLVED" | "CLOSED" (optional)</code></pre>

<h4>Success Response (200):</h4>
<pre><code>{
  "success": true,
  "data": {
    "data": [
      {
        "id": "conv-uuid",
        "subject": "MATHEMATICS",
        "topic": "Quadratic Equations",
        "urgency": "NORMAL",
        "status": "ACTIVE",
        "tutor": {
          "id": "tutor-uuid",
          "user": { "name": "John Williams", "email": "..." }
        },
        "messages": [
          {
            "id": "msg-uuid",
            "content": "Thanks for your help!",
            "createdAt": "2025-12-07T12:30:00.000Z"
          }
        ],
        "createdAt": "2025-12-07T12:00:00.000Z",
        "updatedAt": "2025-12-07T12:30:00.000Z"
      }
    ],
    "meta": {
      "total": 5,
      "page": 1,
      "limit": 10,
      "totalPages": 1
    }
  }
}</code></pre>

<h3>7.3 GET /messages/conversations/:id</h3>
<h4>Success Response (200):</h4>
<pre><code>{
  "success": true,
  "data": {
    "id": "conv-uuid",
    "subject": "MATHEMATICS",
    "topic": "Quadratic Equations",
    "keywords": ["quadratic", "equations"],
    "urgency": "NORMAL",
    "status": "ACTIVE",
    "student": {
      "id": "student-uuid",
      "user": { "name": "Jane Smith", "email": "..." }
    },
    "tutor": {
      "id": "tutor-uuid",
      "user": { "name": "John Williams", "email": "..." }
    },
    "messages": [
      {
        "id": "msg-1-uuid",
        "senderId": "user-uuid",
        "senderType": "STUDENT",
        "content": "I need help with quadratic equations",
        "messageType": "TEXT",
        "isRead": true,
        "createdAt": "2025-12-07T12:00:00.000Z"
      },
      {
        "id": "msg-2-uuid",
        "senderId": "tutor-user-uuid",
        "senderType": "TUTOR",
        "content": "Sure! The quadratic formula is...",
        "messageType": "TEXT",
        "isRead": false,
        "createdAt": "2025-12-07T12:05:00.000Z"
      }
    ],
    "createdAt": "2025-12-07T12:00:00.000Z",
    "updatedAt": "2025-12-07T12:05:00.000Z"
  }
}</code></pre>

<h3>7.4 POST /messages/conversations/:id/assign</h3>
<h4>Request Body:</h4>
<pre><code>{
  "tutorId": "tutor-profile-uuid"
}</code></pre>

<h3>7.5 POST /messages/conversations/:id/close</h3>
<h4>Request Body:</h4>
<pre><code>{
  "status": "RESOLVED"  // or "CLOSED"
}</code></pre>

<div class="page-break"></div>

<!-- SECTION 8: WEBSOCKET -->
<h2 id="websocket">8. WebSocket Real-time Events</h2>

<h3>8.1 Connection Setup</h3>
<pre><code>// src/services/socket.ts
import { io, Socket } from 'socket.io-client';

let socket: Socket | null = null;

export const connectSocket = (token: string) => {
  socket = io('http://localhost:3000/messages', {
    auth: { token },
    transports: ['websocket'],
  });

  socket.on('connect', () => {
    console.log('WebSocket connected');
  });

  socket.on('disconnect', () => {
    console.log('WebSocket disconnected');
  });

  socket.on('connect_error', (error) => {
    console.error('WebSocket connection error:', error);
  });

  return socket;
};

export const disconnectSocket = () => {
  if (socket) {
    socket.disconnect();
    socket = null;
  }
};

export const getSocket = () => socket;</code></pre>

<h3>8.2 Events to Emit (Client ‚Üí Server)</h3>
<table>
  <tr>
    <th>Event</th>
    <th>Payload</th>
    <th>Description</th>
  </tr>
  <tr>
    <td><code>joinConversation</code></td>
    <td><code>"conversation-uuid"</code></td>
    <td>Join a conversation room to receive messages</td>
  </tr>
  <tr>
    <td><code>leaveConversation</code></td>
    <td><code>"conversation-uuid"</code></td>
    <td>Leave a conversation room</td>
  </tr>
  <tr>
    <td><code>typing</code></td>
    <td><code>{ conversationId: "uuid", isTyping: true }</code></td>
    <td>Send typing indicator</td>
  </tr>
</table>

<h3>8.3 Events to Listen (Server ‚Üí Client)</h3>
<table>
  <tr>
    <th>Event</th>
    <th>Payload</th>
    <th>Description</th>
  </tr>
  <tr>
    <td><code>newMessage</code></td>
    <td>Message object</td>
    <td>New message in current conversation</td>
  </tr>
  <tr>
    <td><code>userTyping</code></td>
    <td><code>{ userId: "uuid", isTyping: boolean }</code></td>
    <td>Other user typing indicator</td>
  </tr>
  <tr>
    <td><code>newAssignment</code></td>
    <td><code>{ conversationId, subject, urgency, studentName }</code></td>
    <td>New conversation assigned (tutors)</td>
  </tr>
  <tr>
    <td><code>statusChange</code></td>
    <td><code>{ conversationId, status }</code></td>
    <td>Conversation status changed</td>
  </tr>
</table>

<h3>8.4 Usage in React Component</h3>
<pre><code>// ConversationChat.tsx
useEffect(() => {
  const socket = getSocket();
  if (!socket || !conversationId) return;

  // Join conversation room
  socket.emit('joinConversation', conversationId);

  // Listen for new messages
  socket.on('newMessage', (message) => {
    setMessages(prev => [...prev, message]);
  });

  // Listen for typing
  socket.on('userTyping', ({ userId, isTyping }) => {
    setTypingUsers(prev => 
      isTyping 
        ? [...prev, userId] 
        : prev.filter(id => id !== userId)
    );
  });

  // Cleanup
  return () => {
    socket.emit('leaveConversation', conversationId);
    socket.off('newMessage');
    socket.off('userTyping');
  };
}, [conversationId]);</code></pre>

<div class="page-break"></div>

<!-- SECTION 9: ENUMS -->
<h2 id="enums">9. Data Types & Enums</h2>

<h3>9.1 TypeScript Interfaces</h3>
<pre><code>// src/types/index.ts

// User
interface User {
  id: string;
  email: string;
  name: string | null;
  role: Role;
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
}

// Auth Response
interface AuthResponse {
  user: User;
  tokens: {
    accessToken: string;
    refreshToken: string;
  };
}

// Conversation
interface Conversation {
  id: string;
  studentId: string;
  tutorId: string | null;
  subject: Subject;
  topic: string | null;
  keywords: string[];
  urgency: Urgency;
  status: ConversationStatus;
  student?: { id: string; user: { name: string; email: string } };
  tutor?: { id: string; user: { name: string; email: string } };
  messages: Message[];
  createdAt: string;
  updatedAt: string;
}

// Message
interface Message {
  id: string;
  conversationId: string;
  senderId: string;
  senderType: SenderType;
  content: string | null;
  messageType: MessageType;
  audioUrl?: string;
  audioDuration?: number;
  transcription?: string;
  isRead: boolean;
  createdAt: string;
}

// Paginated Response
interface PaginatedResponse&lt;T&gt; {
  data: T[];
  meta: {
    total: number;
    page: number;
    limit: number;
    totalPages: number;
  };
}</code></pre>

<h3>9.2 Enums</h3>
<pre><code>enum Role {
  USER = "USER",
  ADMIN = "ADMIN",
  TUTOR = "TUTOR",
  STUDENT = "STUDENT"
}

enum Subject {
  MATHEMATICS = "MATHEMATICS",
  PHYSICS = "PHYSICS",
  CHEMISTRY = "CHEMISTRY",
  BIOLOGY = "BIOLOGY",
  ENGLISH = "ENGLISH",
  HISTORY = "HISTORY",
  GEOGRAPHY = "GEOGRAPHY",
  COMPUTER_SCIENCE = "COMPUTER_SCIENCE",
  ECONOMICS = "ECONOMICS",
  ACCOUNTING = "ACCOUNTING",
  GENERAL = "GENERAL"
}

enum MessageType {
  TEXT = "TEXT",
  AUDIO = "AUDIO",
  IMAGE = "IMAGE",
  FILE = "FILE"
}

enum SenderType {
  STUDENT = "STUDENT",
  TUTOR = "TUTOR",
  SYSTEM = "SYSTEM"
}

enum ConversationStatus {
  PENDING = "PENDING",
  ASSIGNED = "ASSIGNED",
  ACTIVE = "ACTIVE",
  RESOLVED = "RESOLVED",
  CLOSED = "CLOSED"
}

enum Urgency {
  LOW = "LOW",
  NORMAL = "NORMAL",
  HIGH = "HIGH",
  URGENT = "URGENT"
}</code></pre>

<div class="page-break"></div>

<!-- SECTION 10: ERROR HANDLING -->
<h2 id="error-handling">10. Error Handling</h2>

<h3>10.1 Standard Error Response Format</h3>
<pre><code>{
  "statusCode": 400,
  "timestamp": "2025-12-07T12:00:00.000Z",
  "path": "/api/v1/auth/login",
  "method": "POST",
  "message": "Error message here",
  "error": "Bad Request"  // Only in development
}</code></pre>

<h3>10.2 Common HTTP Status Codes</h3>
<table>
  <tr>
    <th>Code</th>
    <th>Meaning</th>
    <th>Frontend Action</th>
  </tr>
  <tr>
    <td>200</td>
    <td>Success</td>
    <td>Process response data</td>
  </tr>
  <tr>
    <td>201</td>
    <td>Created</td>
    <td>Resource created, process response</td>
  </tr>
  <tr>
    <td>400</td>
    <td>Bad Request</td>
    <td>Show validation errors to user</td>
  </tr>
  <tr>
    <td>401</td>
    <td>Unauthorized</td>
    <td>Redirect to login (handled by interceptor)</td>
  </tr>
  <tr>
    <td>403</td>
    <td>Forbidden</td>
    <td>Show "Access Denied" message</td>
  </tr>
  <tr>
    <td>404</td>
    <td>Not Found</td>
    <td>Show "Not Found" page/message</td>
  </tr>
  <tr>
    <td>409</td>
    <td>Conflict</td>
    <td>Show specific conflict message (e.g., "Email already exists")</td>
  </tr>
  <tr>
    <td>500</td>
    <td>Server Error</td>
    <td>Show generic error, log for debugging</td>
  </tr>
</table>

<h3>10.3 Validation Error Response (400)</h3>
<pre><code>{
  "statusCode": 400,
  "message": [
    "email must be an email",
    "password must be at least 8 characters"
  ],
  "error": "Bad Request"
}</code></pre>

<div class="page-break"></div>

<!-- SECTION 11: TEST ACCOUNTS -->
<h2 id="test-accounts">11. Test Accounts</h2>

<h3>11.1 Admin Account</h3>
<table>
  <tr><td><strong>Email</strong></td><td>admin@toptutor.com</td></tr>
  <tr><td><strong>Password</strong></td><td>Admin123!</td></tr>
  <tr><td><strong>Role</strong></td><td>ADMIN</td></tr>
</table>

<h3>11.2 Tutor Accounts</h3>
<table>
  <tr>
    <th>Email</th>
    <th>Password</th>
    <th>Name</th>
    <th>Subjects</th>
  </tr>
  <tr>
    <td>john.tutor@toptutor.com</td>
    <td>Tutor123!</td>
    <td>John Williams</td>
    <td>MATHEMATICS, PHYSICS</td>
  </tr>
  <tr>
    <td>sarah.tutor@toptutor.com</td>
    <td>Tutor123!</td>
    <td>Sarah Johnson</td>
    <td>CHEMISTRY, BIOLOGY</td>
  </tr>
  <tr>
    <td>mike.tutor@toptutor.com</td>
    <td>Tutor123!</td>
    <td>Mike Chen</td>
    <td>COMPUTER_SCIENCE, MATHEMATICS</td>
  </tr>
  <tr>
    <td>emma.tutor@toptutor.com</td>
    <td>Tutor123!</td>
    <td>Emma Davis</td>
    <td>ENGLISH, HISTORY</td>
  </tr>
</table>

<h3>11.3 Student Accounts</h3>
<table>
  <tr>
    <th>Email</th>
    <th>Password</th>
    <th>Name</th>
  </tr>
  <tr>
    <td>jane.student@toptutor.com</td>
    <td>Student123!</td>
    <td>Jane Smith</td>
  </tr>
  <tr>
    <td>alex.student@toptutor.com</td>
    <td>Student123!</td>
    <td>Alex Brown</td>
  </tr>
  <tr>
    <td>lisa.student@toptutor.com</td>
    <td>Student123!</td>
    <td>Lisa Wilson</td>
  </tr>
</table>

<div class="page-break"></div>

<!-- SECTION 12: FRONTEND CHECKLIST -->
<h2 id="frontend-checklist">12. Frontend Implementation Checklist</h2>

<h3>12.1 Pages Required</h3>
<table>
  <tr>
    <th>Route</th>
    <th>Component</th>
    <th>Auth Required</th>
    <th>Roles</th>
  </tr>
  <tr><td>/</td><td>Landing Page</td><td>‚ùå</td><td>All</td></tr>
  <tr><td>/login</td><td>Login Page</td><td>‚ùå</td><td>All</td></tr>
  <tr><td>/register</td><td>Register Page</td><td>‚ùå</td><td>All</td></tr>
  <tr><td>/auth/callback</td><td>OAuth Callback Handler</td><td>‚ùå</td><td>All</td></tr>
  <tr><td>/dashboard/student</td><td>Student Dashboard</td><td>‚úÖ</td><td>STUDENT</td></tr>
  <tr><td>/dashboard/tutor</td><td>Tutor Dashboard</td><td>‚úÖ</td><td>TUTOR</td></tr>
  <tr><td>/admin</td><td>Admin Dashboard</td><td>‚úÖ</td><td>ADMIN</td></tr>
  <tr><td>/ask</td><td>Ask Question Page</td><td>‚úÖ</td><td>STUDENT</td></tr>
  <tr><td>/conversations</td><td>Conversations List</td><td>‚úÖ</td><td>STUDENT, TUTOR</td></tr>
  <tr><td>/conversations/:id</td><td>Chat View</td><td>‚úÖ</td><td>STUDENT, TUTOR</td></tr>
  <tr><td>/admin/users</td><td>User Management</td><td>‚úÖ</td><td>ADMIN</td></tr>
  <tr><td>/admin/conversations</td><td>All Conversations</td><td>‚úÖ</td><td>ADMIN</td></tr>
  <tr><td>/profile</td><td>User Profile</td><td>‚úÖ</td><td>All</td></tr>
  <tr><td>/unauthorized</td><td>403 Page</td><td>‚ùå</td><td>All</td></tr>
  <tr><td>*</td><td>404 Page</td><td>‚ùå</td><td>All</td></tr>
</table>

<h3>12.2 Core Features Checklist</h3>
<ul>
  <li>‚òê Authentication (Login, Register, Logout)</li>
  <li>‚òê Google OAuth integration</li>
  <li>‚òê Token refresh mechanism</li>
  <li>‚òê Protected routes based on role</li>
  <li>‚òê Student: Ask question form</li>
  <li>‚òê Student: View my conversations</li>
  <li>‚òê Tutor: View assigned conversations</li>
  <li>‚òê Chat interface with message bubbles</li>
  <li>‚òê Real-time message updates (WebSocket)</li>
  <li>‚òê Typing indicators</li>
  <li>‚òê Notification system for new assignments</li>
  <li>‚òê Admin: User management CRUD</li>
  <li>‚òê Admin: View all conversations</li>
  <li>‚òê Admin: Manual tutor assignment</li>
  <li>‚òê Responsive design (mobile-friendly)</li>
  <li>‚òê Loading states and error handling</li>
  <li>‚òê Toast notifications for actions</li>
</ul>

<h3>12.3 UI Components Needed</h3>
<ul>
  <li>‚òê Navbar (with user menu, notifications)</li>
  <li>‚òê Sidebar (for dashboard navigation)</li>
  <li>‚òê Login/Register forms</li>
  <li>‚òê Conversation list item</li>
  <li>‚òê Chat message bubble</li>
  <li>‚òê Message input with send button</li>
  <li>‚òê Subject badge (colored by subject)</li>
  <li>‚òê Urgency indicator</li>
  <li>‚òê Status badge</li>
  <li>‚òê User avatar</li>
  <li>‚òê Pagination component</li>
  <li>‚òê Modal dialogs</li>
  <li>‚òê Toast/notification component</li>
  <li>‚òê Loading spinner</li>
  <li>‚òê Empty state illustrations</li>
</ul>

<div class="info">
  <strong>üìå Production Notes</strong>
  <ul>
    <li>Replace localhost URLs with production API URL via environment variables</li>
    <li>Implement proper error logging (e.g., Sentry)</li>
    <li>Add rate limiting awareness (show "Too many requests" message)</li>
    <li>Implement proper token storage (consider httpOnly cookies for production)</li>
    <li>Add CSRF protection if using cookies</li>
    <li>Implement proper form validation with user-friendly messages</li>
  </ul>
</div>

<hr style="margin-top: 40px;">
<p style="text-align: center; color: #718096; margin-top: 20px;">
  <strong>Top Tutors API Documentation v1.0</strong><br>
  Generated: December 7, 2025<br>
  For questions, contact the backend team.
</p>

</body>
</html>

